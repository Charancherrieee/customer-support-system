{% extends "base.html" %}

{% block title %}Create New Ticket{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">Create New Support Ticket</h3>
                </div>
                <div class="card-body p-4">
                    <p class="text-muted mb-4">Please provide detailed information about your issue. Our support team will respond as soon as possible.</p>

                    <form method="POST" action="{{ url_for('tickets.create_ticket') }}" class="needs-validation" novalidate>
                        
                        <!-- Category -->
                        <div class="mb-3">
                            <label for="category_id" class="form-label">
                                Category *
                            </label>
                            <select class="form-select" id="category_id" name="category_id" required>
                                <option value="">-- Select a category --</option>
                                {% for category in categories %}
                                <option value="{{ category.category_id }}">
                                    {{ category.category_name }}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="invalid-feedback">Please select a category.</div>
                        </div>

                        <!-- Subject -->
                        <div class="mb-3">
                            <label for="subject" class="form-label">
                                Subject *
                            </label>
                            <input type="text" class="form-control" id="subject" name="subject" 
                                   placeholder="Brief description of your issue" 
                                   minlength="5" maxlength="200" required>
                            <small class="text-muted">Minimum 5 characters, maximum 200 characters</small>
                            <div class="invalid-feedback">Please provide a subject (5-200 characters).</div>
                        </div>

                        <!-- Description -->
                        <div class="mb-3">
                            <label for="description" class="form-label">
                                Description *
                            </label>
                            <textarea class="form-control" id="description" name="description" 
                                      rows="6" placeholder="Please provide detailed information about your issue..."
                                      minlength="20" maxlength="2000" required></textarea>
                            <small class="text-muted">Minimum 20 characters. Be as detailed as possible.</small>
                            <div class="invalid-feedback">Please provide a detailed description (minimum 20 characters).</div>
                        </div>

                        <!-- Priority -->
                        <div class="mb-4">
                            <label for="priority" class="form-label">
                                Priority *
                            </label>
                            <select class="form-select" id="priority" name="priority" required>
                                <option value="low">Low - General inquiry or minor issue</option>
                                <option value="medium" selected>Medium - Normal issue affecting functionality</option>
                                <option value="high">High - Significant issue requiring quick attention</option>
                                <option value="urgent">Urgent - Critical issue blocking work</option>
                            </select>
                        </div>

                        <!-- Priority Guidelines -->
                        <div class="alert alert-info mb-4">
                            <h6 class="alert-heading">Priority Guidelines:</h6>
                            <ul class="mb-0 small">
                                <li><strong>Low:</strong> General questions, feature requests</li>
                                <li><strong>Medium:</strong> Issues affecting some functionality</li>
                                <li><strong>High:</strong> Major features not working properly</li>
                                <li><strong>Urgent:</strong> Complete service outage or data loss</li>
                            </ul>
                        </div>

                        <!-- Buttons -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('tickets.user_dashboard') }}" class="btn btn-outline-secondary">
                                Cancel
                            </a>
                            <button type="submit" class="btn btn-primary btn-lg">
                                Submit Ticket
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Help Section -->
            <div class="card mt-4">
                <div class="card-body">
                    <h5>Tips for Getting Help Faster</h5>
                    <ul>
                        <li>Choose the correct category for your issue</li>
                        <li>Write a clear and descriptive subject line</li>
                        <li>Include steps to reproduce the problem</li>
                        <li>Mention any error messages you received</li>
                        <li>Include your order number if applicable</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Form validation
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();
</script>
{% endblock %}